NEE_Starting_Great_Depression_Effect = {
	hidden_effect = {
		# Set the variables and assign the dynamic modifier to NEE
		set_variable = { NEE_GD_efficiency_cap_var = -0.10 }
		set_variable = { NEE_GD_build_speed_var = -0.19 }
		set_variable = { NEE_GD_consumer_goods_var = 0.34 }
		if = {
			limit = { USA = { has_completed_focus = USA_gwbill_fails } }
			subtract_from_variable = { NEE_GD_efficiency_cap_var = 0.08 }
			subtract_from_variable = { NEE_GD_build_speed_var = 0.17 }
			add_to_variable = { NEE_GD_consumer_goods_var = 0.12 }
		}
		force_update_dynamic_modifier = yes
		add_dynamic_modifier = { modifier = NEE_Great_Depression }
		set_variable = { NEE_GD_timer_var = 100 } #This is the starting variable for the duration between GD spirit reductions
	}
}

NEE_Reduce_Great_Depression_regular = {
	hidden_effect = {
		add_to_variable = { NEE_GD_efficiency_cap_var = 0.01 }
		clamp_variable = {
			var = NEE_GD_efficiency_cap_var
			min = -0.15
			max = 0
		}
		add_to_variable = { NEE_GD_build_speed_var = 0.01 }
		clamp_variable = {
			var = NEE_GD_build_speed_var
			min = -0.20
			max = 0
		}
		subtract_from_variable = { NEE_GD_consumer_goods_var = 0.02 }
		clamp_variable = {
			var = NEE_GD_consumer_goods_var
			min = 0
			max = 0.35
		}
		force_update_dynamic_modifier = yes
		if = {
			limit = {
				check_variable = {
					var = NEE_GD_build_speed_var
					value > -0.13
				}
				NOT = {
					has_idea = NEE_reluctant_populace1
					has_idea = NEE_reluctant_populace2
					has_idea = NEE_reluctant_populace3
					has_idea = NEE_reluctant_populace4
				}
			}
			country_event = newengland.104
		}
	}
}

NEE_Reduce_Great_Depression_medium = {
	hidden_effect = {
		add_to_variable = { NEE_GD_efficiency_cap_var = 0.01 }
		clamp_variable = {
			var = NEE_GD_efficiency_cap_var
			min = -0.15
			max = 0
		}
		add_to_variable = { NEE_GD_build_speed_var = 0.02 }
		clamp_variable = {
			var = NEE_GD_build_speed_var
			min = -0.20
			max = 0
		}
		subtract_from_variable = { NEE_GD_consumer_goods_var = 0.05 }
		clamp_variable = {
			var = NEE_GD_consumer_goods_var
			min = 0
			max = 0.35
		}
		force_update_dynamic_modifier = yes
		if = {
			limit = {
				check_variable = {
					var = NEE_GD_build_speed_var
					value > -0.13
				}
				NOT = {
					has_idea = NEE_reluctant_populace1
					has_idea = NEE_reluctant_populace2
					has_idea = NEE_reluctant_populace3
					has_idea = NEE_reluctant_populace4
				}
			}
			country_event = newengland.104
		}
	}
}

NEE_Reduce_Great_Depression_big = {
	hidden_effect = {
		add_to_variable = { NEE_GD_efficiency_cap_var = 0.03 }
		clamp_variable = {
			var = NEE_GD_efficiency_cap_var
			min = -0.15
			max = 0
		}
		add_to_variable = { NEE_GD_build_speed_var = 0.03 }
		clamp_variable = {
			var = NEE_GD_build_speed_var
			min = -0.20
			max = 0
		}
		subtract_from_variable = { NEE_GD_consumer_goods_var = 0.06 }
		clamp_variable = {
			var = NEE_GD_consumer_goods_var
			min = 0
			max = 0.35
		}
		force_update_dynamic_modifier = yes
		if = {
			limit = {
				check_variable = {
					var = NEE_GD_build_speed_var
					value > -0.13
				}
				NOT = {
					has_idea = NEE_reluctant_populace1
					has_idea = NEE_reluctant_populace2
					has_idea = NEE_reluctant_populace3
					has_idea = NEE_reluctant_populace4
				}
			}
			country_event = newengland.104
		}
	}
}

NEE_Reduce_Neutrality = {
	if = {
		limit = {
			has_idea = NEE_reluctant_populace1
		}
		swap_ideas = {
			remove_idea = NEE_reluctant_populace1
			add_idea = NEE_reluctant_populace2
		}
	}
	else_if = {
		limit = {
			has_idea = NEE_reluctant_populace2
		}
		swap_ideas = {
			remove_idea = NEE_reluctant_populace2
			add_idea = NEE_reluctant_populace3
		}
	}
	else_if = {
		limit = {
			has_idea = NEE_reluctant_populace3
		}
		swap_ideas = {
			remove_idea = NEE_reluctant_populace3
			add_idea = NEE_reluctant_populace4
		}
	}
	else_if = {
		limit = {
			has_idea = NEE_reluctant_populace4
		}
		remove_ideas = NEE_reluctant_populace4
		if = {
			limit = {
				check_variable = {
					var = NEE_GD_build_speed_var
					value > -0.13
				}
			}
			country_event = newengland.104
		}
	}
}

NEE_apply_factory_donation_to_backed_faction = {
	if = {
		limit = {
			NEE = { NEE_is_supporting_USA = yes }
		}
		USA = {
			hidden_effect = { country_event = newengland.231 }
			add_offsite_building = {
				type = arms_factory
				level = NEE.NEE_sent_mil
			}
		}
	}
	else_if = {
		limit = {
			NEE = { NEE_is_supporting_PSA = yes }
		}
		PSA = {
			hidden_effect = { country_event = newengland.231 }
			add_offsite_building = {
				type = arms_factory
				level = NEE.NEE_sent_mil
			}
		}
	}
	else_if = {
		limit = {
			NEE = { NEE_is_supporting_AUS = yes }
		}
		TEX = {
			hidden_effect = { country_event = newengland.231 }
			add_offsite_building = {
				type = arms_factory
				level = NEE.NEE_sent_mil
			}
		}
	}
}

NEE_remove_factory_donation_from_backed_faction = {
	if = {
		limit = {
			NEE = { NEE_is_supporting_USA = yes }
		}
		USA = {
			add_offsite_building = {
				type = arms_factory
				level = NEE.NEE_sent_mil_removal
			}
		}
	}
	else_if = {
		limit = {
			NEE = { NEE_is_supporting_PSA = yes }
		}
		PSA = {
			add_offsite_building = {
				type = arms_factory
				level = NEE.NEE_sent_mil_removal
			}
		}
	}
	else_if = {
		limit = {
			NEE = { NEE_is_supporting_AUS = yes }
		}
		TEX = {
			add_offsite_building = {
				type = arms_factory
				level = NEE.NEE_sent_mil_removal
			}
		}
	}
}

NEE_factory_donation_tt_to_backed_faction_1 = {
	if = {
		limit = {
			NEE = { NEE_is_supporting_USA = yes }
		}
		USA = {
			add_offsite_building = {
				type = arms_factory
				level = 1
			}
		}
	}
	else_if = {
		limit = {
			NEE = { NEE_is_supporting_PSA = yes }
		}
		PSA = {
			add_offsite_building = {
				type = arms_factory
				level = 1
			}
		}
	}
	else_if = {
		limit = {
			NEE = { NEE_is_supporting_AUS = yes }
		}
		TEX = {
			add_offsite_building = {
				type = arms_factory
				level = 1
			}
		}
	}
}

NEE_factory_donation_tt_to_backed_faction_2 = {
	if = {
		limit = {
			NEE = { NEE_is_supporting_USA = yes }
		}
		USA = {
			add_offsite_building = {
				type = arms_factory
				level = 2
			}
		}
	}
	else_if = {
		limit = {
			NEE = { NEE_is_supporting_PSA = yes }
		}
		PSA = {
			add_offsite_building = {
				type = arms_factory
				level = 2
			}
		}
	}
	else_if = {
		limit = {
			NEE = { NEE_is_supporting_AUS = yes }
		}
		TEX = {
			add_offsite_building = {
				type = arms_factory
				level = 2
			}
		}
	}
}

NEE_factory_donation_tt_to_backed_faction_3 = {
	if = {
		limit = {
			NEE = { NEE_is_supporting_USA = yes }
		}
		USA = {
			add_offsite_building = {
				type = arms_factory
				level = 3
			}
		}
	}
	else_if = {
		limit = {
			NEE = { NEE_is_supporting_PSA = yes }
		}
		PSA = {
			add_offsite_building = {
				type = arms_factory
				level = 3
			}
		}
	}
	else_if = {
		limit = {
			NEE = { NEE_is_supporting_AUS = yes }
		}
		TEX = {
			add_offsite_building = {
				type = arms_factory
				level = 3
			}
		}
	}
}

NEE_Reduce_Syndicalist_Terrorist = {
	if = {
		limit = {
			has_idea = USA_socialist_resistance1
		}
		swap_ideas = {
			remove_idea = USA_socialist_resistance1
			add_idea = USA_socialist_resistance2
		}
	}
	else_if = {
		limit = {
			has_idea = USA_socialist_resistance2
		}
		swap_ideas = {
			remove_idea = USA_socialist_resistance2
			add_idea = USA_socialist_resistance3
		}
	}
	else_if = {
		limit = {
			has_idea = USA_socialist_resistance3
		}
		swap_ideas = {
			remove_idea = USA_socialist_resistance3
			add_idea = USA_socialist_resistance4
		}
	}
	else_if = {
		limit = {
			has_idea = USA_socialist_resistance4
		}
		remove_ideas = USA_socialist_resistance4
		clr_country_flag = NEE_has_syndicalist_terrorists
	}
}

NEE_Increase_Syndicalist_Terrorist = {
	if = {
		limit = {
			has_idea = USA_socialist_resistance4
		}
		swap_ideas = {
			remove_idea = USA_socialist_resistance4
			add_idea = USA_socialist_resistance3
		}
	}
	else_if = {
		limit = {
			has_idea = USA_socialist_resistance3
		}
		swap_ideas = {
			remove_idea = USA_socialist_resistance3
			add_idea = USA_socialist_resistance2
		}
	}
	else_if = {
		limit = {
			has_idea = USA_socialist_resistance2
		}
		swap_ideas = {
			remove_idea = USA_socialist_resistance2
			add_idea = USA_socialist_resistance1
		}
	}
}

NEE_Reduce_Longist_Terrorist = {
	if = {
		limit = {
			has_idea = USA_longist_resistance1
		}
		swap_ideas = {
			remove_idea = USA_longist_resistance1
			add_idea = USA_longist_resistance2
		}
	}
	else_if = {
		limit = {
			has_idea = USA_longist_resistance2
		}
		swap_ideas = {
			remove_idea = USA_longist_resistance2
			add_idea = USA_longist_resistance3
		}
	}
	else_if = {
		limit = {
			has_idea = USA_longist_resistance3
		}
		swap_ideas = {
			remove_idea = USA_longist_resistance3
			add_idea = USA_longist_resistance4
		}
	}
	else_if = {
		limit = {
			has_idea = USA_longist_resistance4
		}
		remove_ideas = USA_longist_resistance4
		clr_country_flag = NEE_has_longist_terrorists
	}
}

NEE_Increase_Longist_Terrorist = {
	if = {
		limit = {
			has_idea = USA_longist_resistance4
		}
		swap_ideas = {
			remove_idea = USA_longist_resistance4
			add_idea = USA_longist_resistance3
		}
	}
	else_if = {
		limit = {
			has_idea = USA_longist_resistance3
		}
		swap_ideas = {
			remove_idea = USA_longist_resistance3
			add_idea = USA_longist_resistance2
		}
	}
	else_if = {
		limit = {
			has_idea = USA_longist_resistance2
		}
		swap_ideas = {
			remove_idea = USA_longist_resistance2
			add_idea = USA_longist_resistance1
		}
	}
}

NEE_Appomattox_Finisher = {
	if = {
		limit = {
			has_idea = USA_socialist_resistance4
			has_idea = USA_longist_resistance4
		}
		hidden_effect = { country_event = { id = newengland.272 days = 125 random_days = 50 } }
	}
}

NEE_increase_recovery = {
	if = {
		limit = { has_idea = USA_civil_war_depression_idea }
		swap_ideas = {
			remove_idea = USA_civil_war_depression_idea
			add_idea = NEE_civil_war_depression_idea2
		}
	}
	else_if = {
		limit = { has_idea = NEE_civil_war_depression_idea2 }
		swap_ideas = {
			remove_idea = NEE_civil_war_depression_idea2
			add_idea = NEE_civil_war_depression_idea3
		}
	}
	else_if = {
		limit = { has_idea = NEE_civil_war_depression_idea3 }
		remove_ideas = NEE_civil_war_depression_idea3
	}
}

NEE_increase_recovery_2 = {
	if = {
		limit = { has_idea = NEE_civil_war_aftermath_idea }
		swap_ideas = {
			remove_idea = NEE_civil_war_aftermath_idea
			add_idea = NEE_civil_war_aftermath_idea2
		}
	}
	else_if = {
		limit = { has_idea = NEE_civil_war_aftermath_idea2 }
		swap_ideas = {
			remove_idea = NEE_civil_war_aftermath_idea2
			add_idea = NEE_civil_war_aftermath_idea3
		}
	}
	else_if = {
		limit = { has_idea = NEE_civil_war_aftermath_idea3 }
		swap_ideas = {
			remove_idea = NEE_civil_war_aftermath_idea3
			add_idea = NEE_civil_war_aftermath_idea4
		}
	}
	else_if = {
		limit = { has_idea = NEE_civil_war_aftermath_idea4 }
		swap_ideas = {
			remove_idea = NEE_civil_war_aftermath_idea4
			add_idea = NEE_civil_war_aftermath_idea5
		}
	}
}

NEE_transfer_entente_leader = {
	event_target:entente_transfer_to = {
		set_faction_leader = yes
		hidden_effect = {
			save_global_event_target_as = KR_entente_leader
		}
	}
	if = {
		limit = { has_global_flag = CAN_iedc_created }
		event_target:entente_transfer_to = {
			CAN_transfer_iedc_leadership = yes
		}
	}
}

NEE_Congress_Coalition = {
	# Republican #
	if = {
		limit = {
			has_government = market_liberal
		}
		# Add the Democrat Party as a 20% coalition member
		custom_effect_tooltip = NEE_Democrat_cabinet_tooltip
		hidden_effect = {
			set_variable = { NEE.coalition_stability = 0.2 }
			set_temp_variable = { coalition_partner_var = token:social_liberal }
			set_temp_variable = { coalition_partner_var = token:social_conservative }
			add_to_coalition = yes
		}
	}
	# Democrat #
	else_if = {
		limit = {
			OR = {
				has_government = social_liberal
				has_government = social_conservative
			}
		}
		# Add the Republican Party as a 20% coalition member
		custom_effect_tooltip = NEE_Republican_cabinet_tooltip
		hidden_effect = {
			set_variable = { NEE.coalition_stability = 0.2 }
			set_temp_variable = { coalition_partner_var = token:market_liberal }
			add_to_coalition = yes
		}
	}
}

NEE_Congress_set_up_popularity = {
	# Starting popularity boost
	set_variable = { NEE_dem_boost = 0.05 }
	set_variable = { NEE_rep_boost = 0.05 }
	# Number of taken decisions
	set_variable = { NEE_dem_count = 0 }
	set_variable = { NEE_rep_count = 0 }
	# Decision Cost Variables
	# Republican #
	if = {
		limit = {
			has_government = market_liberal
		}
		set_variable = { NEE_rep_cost = 5 }
		set_variable = { NEE_dem_cost = 15 }
	}
	# Democrat #
	else_if = {
		limit = {
			OR = {
				has_government = social_liberal
				has_government = social_conservative
			}
		}
		set_variable = { NEE_rep_cost = 15 }
		set_variable = { NEE_dem_cost = 5 }
	}
	# Start Coalition after each election
	NEE_Congress_Coalition = yes
}

NEE_Congress_DEM_popularity_effect = {
	# Clear Congress Flag
	clr_country_flag = NEE_taking_congress_decision
	# Add democratic popularity based on the boost value
	set_temp_variable = { ideology_change_var = NEE_dem_boost }
	change_ruling_party_popularity = yes

	subtract_from_variable = { NEE_dem_boost = 0.01 }
	clamp_variable = {
		var = NEE_dem_boost
		min = 0
		max = 0.05
	}
	add_to_variable = { NEE_dem_count = 1 }
	# Temp count variables
	set_temp_variable = { mod_dem_count = NEE_dem_count }
	set_temp_variable = { temp_rep_count = NEE_rep_count }
	set_temp_variable = { temp_dem_count = NEE_dem_count }
	# If a multiple of two DEM policies have been taken, increase the REP boost by 0.01 to a maximum of 0.05
	if = {
		limit = {
			# Modulo math checks the remainder of a temp variable. In this case, the temporary variable mod_dem_count is divided by 2.
			# An odd number of policies will return a value of 1, however, a value of 0 is returned for an even number of policies.
			# The 1 can be discarded but if a value of 0 is returned, increase the REP boost value by 0.01 to a max of 0.05
			modulo_temp_variable = { var = mod_dem_count value = 2 }
			check_variable = {
				mod_dem_count = 0
			}
		}
		add_to_variable = { NEE_rep_boost = 0.01 }
		clamp_variable = {
			var = NEE_rep_boost
			min = 0
			max = 0.05
		}
	}
	## Coalition Work ##
	# Subtract the number of passed Republican policies from the number of passed Democrat policies
	subtract_from_temp_variable = {
		temp_dem_count = temp_rep_count
	}
	if = { # Coalition exists
		limit = {
			OR = {
				is_in_coalition_with_market_liberal = yes
				AND = {
					has_government = market_liberal
					OR = {
						is_in_coalition_with_social_liberal = yes
						is_in_coalition_with_social_conservative = yes
					}
				}
			}
		}
		if = {
			limit = { check_variable = { temp_dem_count > 1 } } # Check if there is a difference greater than 1 between the number of party policies passed
			# Kill the coalition if one side is passing more policies than the other
			custom_effect_tooltip = NEE_congress_coalition_end
			end_coalition = yes
		}
	}
	else_if = { # No coalition exists
		limit = { check_variable = { temp_dem_count = 0 } } # Check if there are an even number of party policies passed
		NEE_Congress_Coalition = yes
	}
}

NEE_Congress_REP_popularity_effect = {
	# Clear Congress Flag
	clr_country_flag = NEE_taking_congress_decision
	# Add Republican popularity based on the boost value
	add_popularity = {
		ideology = market_liberal
		popularity = NEE_rep_boost
	}
	subtract_from_variable = { NEE_rep_boost = 0.01 }
	clamp_variable = {
		var = NEE_rep_boost
		min = 0
		max = 0.05
	}
	add_to_variable = { NEE_rep_count = 1 }
	# Temp count variables
	set_temp_variable = { mod_rep_count = NEE_rep_count }
	set_temp_variable = { temp_rep_count = NEE_rep_count }
	set_temp_variable = { temp_dem_count = NEE_dem_count }
	# If a multiple of two REP policies have been taken, increase the DEM boost by 0.01 to a maximum of 0.05
	if = {
		limit = {
			# Modulo math checks the remainder of a temp variable. In this case, the temporary variable mod_dem_count is divided by 2.
			# An odd number of policies will return a value of 1, however, a value of 0 is returned for an even number of policies.
			# The 1 can be discarded but if a value of 0 is returned, increase the DEM boost value by 0.01 to a max of 0.05
			modulo_temp_variable = { var = mod_rep_count value = 2 }
			check_variable = {
				mod_rep_count = 0
			}
		}
		add_to_variable = { NEE_dem_boost = 0.01 }
		clamp_variable = {
			var = NEE_dem_boost
			min = 0
			max = 0.05
		}
	}
	## Coalition Work ##
	# Subtract the number of passed Democrat policies from the number of passed Republican policies
	subtract_from_temp_variable = {
		temp_rep_count = temp_dem_count
	}
	if = { # Coalition exists
		limit = {
			OR = {
				is_in_coalition_with_market_liberal = yes
				AND = {
					has_government = market_liberal
					OR = {
						is_in_coalition_with_social_liberal = yes
						is_in_coalition_with_social_conservative = yes
					}
				}
			}
		}
		if = {
			limit = { check_variable = { temp_rep_count > 1 } } # Check if there is a difference greater than 1 between the number of party policies passed
			# Kill the coalition if one side is passing more policies than the other
			custom_effect_tooltip = NEE_congress_coalition_end
			end_coalition = yes
		}
	}
	else_if = { # No coalition exists
		limit = { check_variable = { temp_rep_count = 0 } } # Check if there are an even number of party policies passed
		NEE_Congress_Coalition = yes
	}
}

NEE_Returning_American_Land_effect_tt = {
	# Transfer CAN lands held by NEE back to CAN
	effect_tooltip = {
		every_state = {
			limit = {
				is_owned_by = NEE
				NOT = { is_core_of = NEE }
				is_core_of = CAN
			}
			if = {
				limit = { is_claimed_by = NEE }
				remove_claim_by = NEE
			}
			transfer_state_to = CAN
		}
		# CAN hands land that they directly own back to NEE
		every_state = {
			limit = {
				is_owned_by = CAN
				NOT = { is_core_of = CAN }
				OR = {
					is_mainland_america = yes
					state = 463 #Alaska
					state = 629 #Hawaii
					state = 685 #Panama Canal
					state = 686 #Puerto Rico
				}
			}
			if = {
				limit = { is_claimed_by = CAN }
				remove_claim_by = CAN
			}
			transfer_state_to = NEE
		}
	}
	set_country_flag = nee_returns_american_territory
	NEE = { country_event = newengland.304 }
	# Check if WIF owns PR
	if = {
		limit = {
			WIF = {
				686 = { #Puerto Rico
					is_owned_and_controlled_by = WIF
				}
				is_subject_of = CAN
			}
		}
		WIF = { country_event = newengland.301 } #Inform WIF that CAN is giving PR back to NEE
		effect_tooltip = { NEE = { transfer_state = 686 } }
	}
	# Check if PUE is in the Entente
	if = {
		limit = {
			PUE = {
				686 = { #Puerto Rico
					is_owned_and_controlled_by = PREV
				}
				is_subject_of = CAN
			}
		}
		PUE = { country_event = newengland.302 } #Inform PUE that they are being given back to the US
		effect_tooltip = { NEE = { transfer_state = 686 } }
	}
	# Check if the Panama Canal is owned by a country in the Entente
	if = {
		limit = {
			var:685.owner = {
				is_in_faction_with = CAN
			}
		}
		var:685.owner = { country_event = newengland.303 } #Inform Entente country that CAN is asking them to give back the Canal to the US
		effect_tooltip = { NEE = { transfer_state = 685 } }
	}
	# Check if HAW is in the Entente
	if = {
		limit = {
			HAW = {
				is_subject_of = CAN
			}
		}
		HAW = { country_event = newengland.307 } #Inform HAW that they are being given back to the US
		effect_tooltip = { NEE = { annex_country = { target = HAW } } }
	}
}

NEE_Returning_American_Land = {
	# Transfer CAN lands held by NEE back to CAN
	every_state = {
		limit = {
			is_owned_by = NEE
			NOT = { is_core_of = NEE }
			is_core_of = CAN
		}
		if = {
			limit = { is_claimed_by = NEE }
			remove_claim_by = NEE
		}
		transfer_state_to = CAN
	}
	# CAN hands land that they directly own back to NEE
	every_state = {
		limit = {
			is_owned_by = CAN
			NOT = { is_core_of = CAN }
			OR = {
				is_mainland_america = yes
				state = 463 #Alaska
				state = 629 #Hawaii
				state = 685 #Panama Canal
				state = 686 #Puerto Rico
			}
		}
		if = {
			limit = { is_claimed_by = CAN }
			remove_claim_by = CAN
		}
		transfer_state_to = NEE
	}
	# Check if WIF owns PR
	if = {
		limit = {
			WIF = {
				686 = { #Puerto Rico
					is_owned_and_controlled_by = WIF
				}
				is_subject_of = CAN
			}
		}
		WIF = { country_event = newengland.301 } #Inform WIF that CAN is giving PR back to NEE
		effect_tooltip = { NEE = { transfer_state = 686 } }
	}
	# Check if PUE is in the Entente
	if = {
		limit = {
			PUE = {
				686 = { #Puerto Rico
					is_owned_and_controlled_by = PREV
				}
				is_subject_of = CAN
			}
		}
		PUE = { country_event = newengland.302 } #Inform PUE that they are being given back to the US
		effect_tooltip = { NEE = { transfer_state = 686 } }
	}
	# Check if the Panama Canal is owned by a country in the Entente
	if = {
		limit = {
			var:685.owner = {
				is_in_faction_with = CAN
			}
		}
		var:685.owner = { country_event = newengland.303 } #Inform Entente country that CAN is asking them to give back the Canal to the US
		effect_tooltip = { NEE = { transfer_state = 685 } }
	}
	# Check if HAW is in the Entente
	if = {
		limit = {
			HAW = {
				is_subject_of = CAN
			}
		}
		HAW = { country_event = newengland.307 } #Inform HAW that they are being given back to the US
		effect_tooltip = { NEE = { annex_country = { target = HAW } } }
	}
}

NEE_MEX_Concessions = {
	if = {
		limit = {
			NOT = {
				has_government = social_democrat
			}
		}
		# If MEX is a puppet, in a faction, or at war, remove them from every instance
		clear_all_relations = yes
		# MEX must switch to Soc Dem path
		set_politics = {
			ruling_party = social_democrat
		}
		complete_national_focus = MEX_social_democrat1
		# Demobilize Mexico
		if = {
			limit = {
				has_idea = MEX_solderas_idea
			}
			remove_ideas = MEX_solderas_idea
		}
		add_ideas = disarmed_nation
		set_country_flag = cannot_have_conscription
		# Add the NEE guarantee
		NEE = {
			diplomatic_relation = {
				country = MEX
				relation = guarantee
			}
		}
		# Return of Oil Barons land
		give_resource_rights = { receiver = NEE state = 479 }
		give_resource_rights = { receiver = NEE state = 480 }
	}
	else = {
		# If MEX is a puppet, in a faction, or at war, remove them from every instance
		clear_all_relations = yes
		# Return of Oil Barons land
		give_resource_rights = { receiver = NEE state = 479 }
		give_resource_rights = { receiver = NEE state = 480 }
		# Mutual NAP to secure the Southern US Border
		diplomatic_relation = {
			country = NEE
			relation = non_aggression_pact
			active = yes
		}
		NEE = {
			diplomatic_relation = {
				country = MEX
				relation = non_aggression_pact
				active = yes
			}
			diplomatic_relation = {
				country = MEX
				relation = guarantee
			}
		}
	}
}

# global scope
release_targeted_CENtag_no_puppet = {
	if = {
		limit = { has_war = yes }
		every_owned_state = {
			limit = {
				is_core_of = var:tag_to_release
			}
			set_state_owner_to = var:tag_to_release
			set_state_province_controller = {
				controller = owner
				limit = { NOT = { has_war_with = PREV.owner } }
			}
		}
	}
	else = {
		every_owned_state = {
			limit = {
				is_core_of = var:tag_to_release
			}
			transfer_state_to = var:tag_to_release
		}
	}
}

NEE_Form_Democracy_plus_OAS = {
	if = {
		limit = { tag = MEX }
		set_politics = { ruling_party = authoritarian_democrat }
		NEE = { add_to_faction = MEX }
	}
	else_if = {
		limit = { tag = CEN }
		if = {
			limit = { owns_state = 316 }
			effect_tooltip = { release = COS }
			hidden_effect = {
				set_temp_variable = { tag_to_release = COS }
				release_targeted_CENtag_no_puppet = yes
			}
			COS = { set_politics = { ruling_party = social_conservative } }
			NEE = { add_to_faction = COS }
		}

		effect_tooltip = { release = GUA }
		hidden_effect = {
			GUA_restore_missing_characters = yes
			set_temp_variable = { tag_to_release = GUA }
			release_targeted_CENtag_no_puppet = yes
			GUA = { set_politics = { ruling_party = authoritarian_democrat } }
		}
		if = {
			limit = { owns_state = 311 }
			GUA = {
				add_state_claim = 311
				transfer_state = 311
			}
		}
		NEE = { add_to_faction = GUA }

		effect_tooltip = { release = NIC }
		hidden_effect = {
			NIC_restore_missing_characters = yes
			set_temp_variable = { tag_to_release = NIC }
			release_targeted_CENtag_no_puppet = yes
			NIC = { set_politics = { ruling_party = social_liberal } }
		}
		NEE = { add_to_faction = NIC }

		effect_tooltip = { release = HON }
		hidden_effect = {
			HON_restore_missing_characters = yes
			set_temp_variable = { tag_to_release = HON }
			release_targeted_CENtag_no_puppet = yes
			HON = { set_politics = { ruling_party = social_conservative } }
		}
		NEE = { add_to_faction = HON }

		effect_tooltip = { release = ELS }
		hidden_effect = {
			ELS_restore_missing_characters = yes
			set_temp_variable = { tag_to_release = ELS }
			release_targeted_CENtag_no_puppet = yes
			ELS = { set_politics = { ruling_party = social_liberal } }
		}
		NEE = { add_to_faction = ELS }
	}
	else_if = {
		limit = { tag = GUA }
		set_politics = { ruling_party = authoritarian_democrat }
		NEE = { add_to_faction = GUA }
	}
	else_if = {
		limit = { tag = ELS }
		set_politics = { ruling_party = social_liberal }
		NEE = { add_to_faction = ELS }
	}
	else_if = {
		limit = { tag = NIC }
		set_politics = { ruling_party = social_liberal }
		NEE = { add_to_faction = NIC }
	}
	else_if = {
		limit = { tag = HON }
		set_politics = { ruling_party = social_conservative }
		NEE = { add_to_faction = HON }
	}
	else_if = {
		limit = { tag = PAN }
		set_politics = { ruling_party = market_liberal }
		complete_national_focus = PAN_conservative_government
		NEE = { add_to_faction = PAN }
	}
	else_if = {
		limit = { tag = CUB }
		set_politics = { ruling_party = market_liberal }
		NEE = { add_to_faction = CUB }
	}
	else_if = {
		limit = { tag = HAI }
		set_politics = { ruling_party = social_liberal }
		NEE = { add_to_faction = HAI }
	}
	else_if = {
		limit = { tag = DOM }
		set_politics = { ruling_party = market_liberal }
		NEE = { add_to_faction = DOM }
	}
	else_if = {
		limit = { tag = COL }
		set_politics = { ruling_party = social_conservative }
		NEE = { add_to_faction = COL }
	}
	else_if = {
		limit = { tag = VEN }
		set_politics = { ruling_party = paternal_autocrat }
		NEE = { add_to_faction = VEN }
	}
	else_if = {
		limit = { tag = ECU }
		set_politics = { ruling_party = social_liberal }
		NEE = { add_to_faction = ECU }
	}
	else_if = {
		limit = { tag = PRU }
		set_politics = { ruling_party = market_liberal }
		NEE = { add_to_faction = PRU }
	}
	else_if = {
		limit = { tag = BOL }
		set_politics = { ruling_party = social_conservative }
		NEE = { add_to_faction = BOL }
	}
	else_if = {
		limit = { tag = CHL }
		set_politics = { ruling_party = social_liberal }
		NEE = { add_to_faction = CHL }
	}
	else_if = {
		limit = { tag = ARG }
		set_politics = { ruling_party = market_liberal }
		NEE = { add_to_faction = ARG }
	}
	else_if = {
		limit = { tag = PAR }
		set_politics = { ruling_party = social_conservative }
		NEE = { add_to_faction = PAR }
	}
	else_if = {
		limit = { tag = URG }
		set_politics = { ruling_party = social_conservative }
		NEE = { add_to_faction = URG }
	}
	else_if = {
		limit = { tag = BRA }
		set_politics = { ruling_party = authoritarian_democrat }
		NEE = { add_to_faction = BRA }
	}
	else = {
		set_politics = { ruling_party = social_liberal }
		NEE = { add_to_faction = THIS }
	}
}

NEE_BRA_specific_investment = {
	496 = {
		add_resource = {
			type = steel
			amount = 1
		}
	}
	if = {
		limit = {
			NEE = { has_completed_focus = NEE_Reciprocal_Defence }
		}
		add_to_tech_sharing_group = us_research
	}
	else = {
		set_country_flag = instant_research_promise
	}
	if = {
		limit = {
			NEE = { has_completed_focus = NEE_American_Officer_Training }
		}
		add_ideas = NEE_American_Officers_idea
	}
	else = {
		set_country_flag = instant_officers_promise
	}
	diplomatic_relation = {
		country = NEE
		relation = non_aggression_pact
		active = yes
	}
	diplomatic_relation = {
		country = NEE
		relation = military_access
		active = yes
	}
	NEE = {
		diplomatic_relation = {
			country = BRA
			relation = non_aggression_pact
			active = yes
		}
		diplomatic_relation = {
			country = BRA
			relation = military_access
			active = yes
		}
		diplomatic_relation = {
			country = BRA
			relation = guarantee
		}
	}
}

NEE_Political_Trial_Event_Queue = {
	hidden_effect = {
		if = {
			limit = {
				has_global_flag = USA_CSA_existed
				NOT = {
					has_country_flag = NEE_trialled_CSA
				}
			}
			country_event = { id = newengland.250 days = 15 }
		}
		else_if = {
			limit = {
				has_global_flag = USA_TEX_existed
				NOT = {
					has_country_flag = NEE_trialled_TEX
				}
			}
			country_event = { id = newengland.251 days = 15 }
		}
		else_if = {
			limit = {
				has_global_flag = USA_PSA_existed
				NOT = {
					has_country_flag = NEE_trialled_PSA
					has_country_flag = PSA_NEE_Friends
				}
			}
			country_event = { id = newengland.252 days = 15 }
		}
		else_if = {
			limit = {
				NOT = {
					has_country_flag = NEE_trialled_USA
				}
			}
			country_event = { id = newengland.253 days = 15 }
		}
		else = {
			clr_country_flag = NEE_trialled_CSA
			clr_country_flag = NEE_trialled_TEX
			clr_country_flag = NEE_trialled_PSA
			clr_country_flag = NEE_trialled_USA
		}
	}
}

NEE_General_Trial_Event_Queue = {
	hidden_effect = {
		if = {
			limit = {
				has_global_flag = USA_TEX_existed
				NOT = {
					has_country_flag = NEE_trialled_TEX_general
				}
			}
			country_event = { id = newengland.255 days = 15 }
		}
		else_if = {
			limit = {
				has_global_flag = USA_PSA_existed
				NOT = {
					has_country_flag = NEE_trialled_PSA_general
					has_country_flag = PSA_NEE_Friends
				}
			}
			country_event = { id = newengland.256 days = 15 }
		}
		else_if = {
			limit = {
				NOT = {
					has_country_flag = NEE_trialled_USA_general
				}
			}
			country_event = { id = newengland.254 days = 15 }
		}
		else = {
			clr_country_flag = NEE_trialled_TEX_general
			clr_country_flag = NEE_trialled_PSA_general
			clr_country_flag = NEE_trialled_USA_general
		}
	}
}

NEE_SFA_Investment_effect = {
	# Add idea if it doesn't have one
	if = {
		limit = {
			NOT = {
				has_idea = NEE_SFA_investment_idea_1
			}
		}
		add_ideas = NEE_SFA_investment_idea_1
	}
	# Swap to upgraded idea
	else_if = {
		limit = {
			has_idea = NEE_SFA_investment_idea_1
		}
		swap_ideas = {
			remove_idea = NEE_SFA_investment_idea_1
			add_idea = NEE_SFA_investment_idea_2
		}
	}
}

NEE_Pointblank = {
	if = {
		limit = {
			has_country_flag = nee_prepared_pointblank
			NOT = {
				395 = {
					is_owned_and_controlled_by_ROOT_or_ally = yes
				}
				396 = {
					is_owned_and_controlled_by_ROOT_or_ally = yes
				}
				393 = {
					is_owned_and_controlled_by_ROOT_or_ally = yes
				}
				261 = {
					is_owned_and_controlled_by_ROOT_or_ally = yes
				}
			}
		}
		country_event = newengland.76
		var:261.owner = {
			country_event = { id = newengland.76 random_hours = 1 }
		}
		var:396.owner = {
			country_event = { id = newengland.76 random_hours = 4 }
		}
		var:395.owner = {
			country_event = { id = newengland.76 random_hours = 8 }
		}
		var:393.owner = {
			country_event = { id = newengland.76 random_hours = 12 }
		}
	}
}

NEE_Determine_Legitimacy = {
	NEE = {
		## Initialize variables
		set_temp_variable = { NEE_Dem_Legitimacy = 0 }
		set_temp_variable = { PSA_Dem_Legitimacy = 0 }
		if = { #If Mac couped a democratic President, PSA gains legitimacy
			limit = {
				PSA = { has_country_flag = PSA_restored_vice_president }
			}
			add_to_temp_variable = { PSA_Dem_Legitimacy = 25 }
		}
		## Score the important states
		# Denver
		if = {
			limit = { 382 = { is_owned_by = NEE } }
			add_to_temp_variable = { NEE_Dem_Legitimacy = 36 }
		}
		else_if = {
			limit = { 382 = { is_owned_by = PSA } }
			add_to_temp_variable = { PSA_Dem_Legitimacy = 36 }
		}
		# St. Louis
		if = {
			limit = { 373 = { is_owned_by = NEE } }
			add_to_temp_variable = { NEE_Dem_Legitimacy = 24 }
		}
		else_if = {
			limit = { 373 = { is_owned_by = PSA } }
			add_to_temp_variable = { PSA_Dem_Legitimacy = 24 }
		}
		# Chicago
		if = {
			limit = { 395 = { is_owned_by = NEE } }
			add_to_temp_variable = { NEE_Dem_Legitimacy = 40 }
		}
		else_if = {
			limit = { 395 = { is_owned_by = PSA } }
			add_to_temp_variable = { PSA_Dem_Legitimacy = 40 }
		}
		# New Orleans
		if = {
			limit = { 371 = { is_owned_by = NEE } }
			add_to_temp_variable = { NEE_Dem_Legitimacy = 40 }
		}
		else_if = {
			limit = { 371 = { is_owned_by = PSA } }
			add_to_temp_variable = { PSA_Dem_Legitimacy = 40 }
		}
		# Washington D.C.
		if = {
			limit = { 361 = { is_owned_by = NEE } }
			add_to_temp_variable = { NEE_Dem_Legitimacy = 60 }
		}
		else_if = {
			limit = { 361 = { is_owned_by = PSA } }
			add_to_temp_variable = { PSA_Dem_Legitimacy = 60 }
		}
		## Add NEE legitimacy value
		add_to_temp_variable = { NEE_Dem_Legitimacy = NEE_legitimacy }
		## Add military divsions
		# NEE
		set_temp_variable = { NEE_mil_points = var:NEE.num_battalions }
		divide_temp_variable = { NEE_mil_points = 5 }
		round_temp_variable = NEE_mil_points
		# PSA
		set_temp_variable = { PSA_mil_points = var:PSA.num_battalions }
		divide_temp_variable = { PSA_mil_points = 5 }
		round_temp_variable = PSA_mil_points
		# Calculation
		add_to_temp_variable = { NEE_Dem_Legitimacy = NEE_mil_points }
		add_to_temp_variable = { PSA_Dem_Legitimacy = PSA_mil_points }
		## Calculate ratio
		# Set up denominator
		set_temp_variable = { Legitmacy_Denominator = 0 }
		add_to_temp_variable = { Legitmacy_Denominator = NEE_Dem_Legitimacy }
		add_to_temp_variable = { Legitmacy_Denominator = PSA_Dem_Legitimacy }
		# get the 0.X ratio
		divide_temp_variable = { NEE_Dem_Legitimacy = Legitmacy_Denominator }
		divide_temp_variable = { PSA_Dem_Legitimacy = Legitmacy_Denominator }
		# multiply to 100
		multiply_temp_variable = { NEE_Dem_Legitimacy = 100 }
		set_variable = { NEE_Dem_Legitimacy_Full = NEE_Dem_Legitimacy }
		multiply_temp_variable = { PSA_Dem_Legitimacy = 100 }
		set_variable = { PSA_Dem_Legitimacy_Full = PSA_Dem_Legitimacy }
		## Determine which side has better legitimacy
		# set leader flag
		if = {
			limit = {
				check_variable = {
					var = NEE_Dem_Legitimacy
					value = PSA_Dem_Legitimacy
					compare = greater_than_or_equals
				}
			}
			set_country_flag = NEE_Leader
			log = "KR_Event_Logging;NEE WINS ACW;[GetDateText]"
		}
		else_if = {
			limit = {
				check_variable = {
					NEE_Dem_Legitimacy < PSA_Dem_Legitimacy
				}
			}
			set_country_flag = PSA_Leader
			log = "KR_Event_Logging;PSA WINS ACW;[GetDateText]"
		}
	}
}

NEE_Legitimacy_Check_Effect = {
	NEE_President_Swap = yes
	PSA = {
		hidden_effect = {
			every_character = { set_nationality = NEE }
			transfer_navy = { target = NEE }
		}
		every_core_state = { add_core_of = NEE }
		NEE = {
			annex_country = { target = PSA transfer_troops = yes }
			dismantle_faction = yes
		}
		if = {
			limit = { is_ai = no }
			NEE = { change_tag_from = PSA }
		}
	}
}

NEE_President_Swap = {
	# Swapping leaders/elections if need be
	if = {
		limit = { has_country_flag = PSA_Leader }
		hidden_effect = {
			if = {
				limit = { NOT = { has_government = PSA } }
				if = {
					limit = { date > 1944.11.05 }
					set_politics = {
						ruling_party = var:PSA.current_party_ideology_group
						last_election = "1944.11.05"
						election_frequency = 48
						elections_allowed = yes
					}
				}
				if = {
					limit = { date > 1940.11.05 }
					set_politics = {
						ruling_party = var:PSA.current_party_ideology_group
						last_election = "1940.11.05"
						election_frequency = 48
						elections_allowed = yes
					}
				}
				else = {
					set_politics = {
						ruling_party = var:PSA.current_party_ideology_group
						last_election = "1936.11.05"
						election_frequency = 48
						elections_allowed = yes
					}
				}
			}
		}
		PSA = {
			random_character = {
				limit = { is_country_leader = yes }
				set_variable = { NEE.president = THIS } #doesn't work as temp variable
				set_nationality = ROOT
			}
		}
		var:NEE.president = { promote_character = yes }
		clear_variable = NEE.president
	}
}

NEE_Flavour_Events = {
	### Firing the Flavour Events ###
	calculate_days_since_game_start = yes

	# First event fires around May 10th, 495 days after game start
	set_temp_variable = { days_value = 495 }
	# Determine the days left to reach the target date
	subtract_from_temp_variable = { days_value = days_to_event }
	# If the target date is in the future, fire the event
	if = {
		limit = {
			check_variable = { days_value > 0 }
		}
		country_event = { id = newengland.31 days = days_value } # Cpt. Courageous
	}

	### REPEAT THIS AS NEEDED ###
	# Add days between subsequent events
	add_to_temp_variable = { days_value = 16 }
	# If the target date is in the future, fire the event
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.33 days = days_value } # Remington Rand
	}

	add_to_temp_variable = { days_value = 33 } #49
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.36 days = days_value } # Shoe Strike
	}

	add_to_temp_variable = { days_value = 175 } #224
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.30 days = days_value } # Dr. Seuss
	}

	add_to_temp_variable = { days_value = 38 } #262
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.65 days = days_value } # Niagara
	}

	add_to_temp_variable = { days_value = 18 } #280
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.181 days = days_value } # Ski Patrol
	}

	add_to_temp_variable = { days_value = 20 } #300
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.186 days = days_value } # Eleanor Roosevelt
	}

	add_to_temp_variable = { days_value = 73 } #373
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.66 days = days_value } # Chocolate Chip
	}

	add_to_temp_variable = { days_value = 91 } #464
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.67 days = days_value } # Thousand Island Bridge
	}

	add_to_temp_variable = { days_value = 66 } #530
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.17 days = days_value } # Basilica
	}

	add_to_temp_variable = { days_value = 60 } #590
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.28 days = days_value } # Basilica
	}

	add_to_temp_variable = { days_value = 167 } #757
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.18 days = days_value } # Sit Down Strikes
	}

	add_to_temp_variable = { days_value = 54 } #811
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.69 days = days_value } # Dark Victory
	}

	add_to_temp_variable = { days_value = 25 } #836
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.184 days = days_value } # Census Questions
	}

	add_to_temp_variable = { days_value = 26 } #862
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.19 days = days_value } # Baseball Hall of Fame
	}

	add_to_temp_variable = { days_value = 270 } #1132
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.32 days = days_value } # Betty
	}

	add_to_temp_variable = { days_value = 43 } #1175
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.20 days = days_value } # NYC Train Crash
	}

	add_to_temp_variable = { days_value = 77 } #1252
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.4610 days = days_value } # Replace Winant
	}

	add_to_temp_variable = { days_value = 171 } #1423
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.21 days = days_value } # NH Earthquake
	}

	add_to_temp_variable = { days_value = 77 } #1500
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.23 days = days_value } # Cpt. America
	}

	add_to_temp_variable = { days_value = 92 } #1592
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.24 days = days_value } # BSA death
	}

	add_to_temp_variable = { days_value = 268 } #1860
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.187 days = days_value } # OWI Established
	}

	add_to_temp_variable = { days_value = 152 } #2012
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.25 days = days_value } # RCAF Crash
	}

	add_to_temp_variable = { days_value = 12 } #2024
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.27 days = days_value } # BEANO
	}

	add_to_temp_variable = { days_value = 62 } #2086
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.165 days = days_value } # Moffat Passes Away
	}

	add_to_temp_variable = { days_value = 317 } #2403
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.26 days = days_value } # Lackawanna
	}

	add_to_temp_variable = { days_value = 120 } #2523
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.150 days = days_value } # Coconut Grove
	}

	add_to_temp_variable = { days_value = 358 } #2881
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.170 days = days_value } # Intelligence Upgrade
	}

	add_to_temp_variable = { days_value = 400 } #3281
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.29 days = days_value } # Town Line
	}

	add_to_temp_variable = { days_value = 93 } #3374
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.168 days = days_value } # Dulles rails against TI
	}

	add_to_temp_variable = { days_value = 797 } #4171
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.4620 days = days_value } # Harriman event checker
	}

	add_to_temp_variable = { days_value = 526 } #4697
	if = {
		limit = { check_variable = { days_value > 0 } }
		country_event = { id = newengland.177 days = days_value } # Ambassador Steinhardt dies
	}
}

NEE_Change_Legitimacy = {
	if = {
		limit = { check_variable = { NEE_legitimacy_change < 0 } }
		add_to_variable = {
			NEE_legitimacy = NEE_legitimacy_change
			tooltip = NEE_legitimacy_decrease
		}
	}
	else = {
		add_to_variable = {
			NEE_legitimacy = NEE_legitimacy_change?5 #defaults to +5 if not set
			tooltip = NEE_legitimacy_increase
		}
	}
	clamp_variable = {
		var = NEE_legitimacy
		min = 0
		max = 100
	}
}

NEE_recalculate_smuggling_LL = {
	set_variable = { LL_gun_route = 0 }
	set_variable = { LL_people_route = 0 }

	# Lake Line route
	if = {
		limit = {
			261 = { NOT = { has_state_flag = blocked_route } }
		}
		add_to_variable = { LL_gun_route = 100 }
		add_to_variable = { LL_people_route = 120 }
	}
	if = {
		limit = {
			393 = { NOT = { has_state_flag = blocked_route } }
		}
		add_to_variable = { LL_gun_route = 100 }
		add_to_variable = { LL_people_route = 120 }
	}
	if = {
		limit = {
			391 = { NOT = { has_state_flag = blocked_route } }
		}
		add_to_variable = { LL_gun_route = 100 }
		add_to_variable = { LL_people_route = 120 }
	}
}

NEE_recalculate_smuggling_CL = {
	set_variable = {
		CL_gun_route = 0
	}
	set_variable = {
		CL_people_route = 0
	}

	# Central Line route
	if = {
		limit = {
			261 = { NOT = { has_state_flag = blocked_route } }
		}
		add_to_variable = { CL_gun_route = 60 }
		add_to_variable = { CL_people_route = 110 }
	}
	if = {
		limit = {
			369 = { NOT = { has_state_flag = blocked_route } }
		}
		add_to_variable = { CL_gun_route = 60 }
		add_to_variable = { CL_people_route = 110 }
	}
	if = {
		limit = {
			370 = { NOT = { has_state_flag = blocked_route } }
		}
		add_to_variable = { CL_gun_route = 60 }
		add_to_variable = { CL_people_route = 110 }
	}
}

NEE_recalculate_smuggling_EL = {
	set_variable = {
		EL_gun_route = 0
	}
	set_variable = {
		EL_people_route = 0
	}

	# Eastern Line route
	if = {
		limit = {
			359 = { NOT = { has_state_flag = blocked_route } }
		}
		add_to_variable = { EL_gun_route = 80 }
		add_to_variable = { EL_people_route = 90 }
	}
	if = {
		limit = {
			362 = { NOT = { has_state_flag = blocked_route } }
		}
		add_to_variable = { EL_gun_route = 80 }
		add_to_variable = { EL_people_route = 90 }
	}
	if = {
		limit = {
			364 = { NOT = { has_state_flag = blocked_route } }
		}
		add_to_variable = { EL_gun_route = 80 }
		add_to_variable = { EL_people_route = 90 }
	}
}

NEE_LL_Success = {
	if = {
		limit = {
			OR = {
				391 = { has_state_flag = helped_parallel_group }
				393 = { has_state_flag = helped_parallel_group }
				261 = { has_state_flag = helped_parallel_group }
			}
		}
		391 = { clr_state_flag = helped_parallel_group }
		393 = { clr_state_flag = helped_parallel_group }
		261 = { clr_state_flag = helped_parallel_group }
	}
	# Smuggle Efforts
	custom_effect_tooltip = NEE_LL_add_guns
	set_temp_variable = { NEE_LL_people_army = LL_people_route }
	multiply_temp_variable = { NEE_LL_people_army = 0.6 }
	set_temp_variable = { NEE_LL_people_civ = LL_people_route }
	multiply_temp_variable = { NEE_LL_people_civ = 0.4 }
	add_equipment_to_stockpile = {
		type = infantry_equipment
		amount = var:NEE.LL_gun_route
		producer = var:261.owner
	}
	add_manpower = NEE.NEE_LL_people_army
	random_owned_controlled_state = {
		add_manpower = NEE_LL_people_civ
	}
	# Reset the route
	NEE_recalculate_smuggling_LL = yes
	hidden_effect = { country_event = newengland.500 }
}

NEE_CL_Success = {
	if = {
		limit = {
			OR = {
				370 = { has_state_flag = helped_parallel_group }
				369 = { has_state_flag = helped_parallel_group }
				261 = { has_state_flag = helped_parallel_group }
			}
		}
		370 = { clr_state_flag = helped_parallel_group }
		369 = { clr_state_flag = helped_parallel_group }
		261 = { clr_state_flag = helped_parallel_group }
	}
	# Smuggle Efforts
	custom_effect_tooltip = NEE_CL_add_guns
	set_temp_variable = { NEE_CL_people_army = CL_people_route }
	multiply_temp_variable = { NEE_CL_people_army = 0.6 }
	set_temp_variable = { NEE_CL_people_civ = CL_people_route }
	multiply_temp_variable = { NEE_CL_people_civ = 0.4 }
	add_equipment_to_stockpile = {
		type = infantry_equipment
		amount = var:NEE.CL_gun_route
		producer = var:261.owner
	}
	add_manpower = NEE.NEE_CL_people_army
	random_owned_controlled_state = {
		add_manpower = NEE_CL_people_civ
	}
	# Reset the route
	NEE_recalculate_smuggling_CL = yes
	hidden_effect = { country_event = newengland.501 }
}

NEE_EL_Success = {
	if = {
		limit = {
			OR = {
				364 = { has_state_flag = helped_parallel_group }
				362 = { has_state_flag = helped_parallel_group }
				359 = { has_state_flag = helped_parallel_group }
			}
		}
		364 = { clr_state_flag = helped_parallel_group }
		362 = { clr_state_flag = helped_parallel_group }
		359 = { clr_state_flag = helped_parallel_group }
	}
	# Smuggle Efforts
	custom_effect_tooltip = NEE_EL_add_guns
	set_temp_variable = { NEE_EL_people_army = EL_people_route }
	multiply_temp_variable = { NEE_EL_people_army = 0.6 }
	set_temp_variable = { NEE_EL_people_civ = EL_people_route }
	multiply_temp_variable = { NEE_EL_people_civ = 0.4 }
	add_equipment_to_stockpile = {
		type = infantry_equipment
		amount = var:NEE.EL_gun_route
		producer = var:359.owner
	}
	add_manpower = NEE.NEE_EL_people_army
	random_owned_controlled_state = {
		add_manpower = NEE_EL_people_civ
	}
	# Reset the route
	NEE_recalculate_smuggling_EL = yes
	hidden_effect = { country_event = newengland.502 }
}

NEE_move_generals = {
	NEE = {
		hidden_effect = { NEE_leslie_groves_jr = { demote_leader = yes } }
		NEE_leslie_groves_jr = { set_nationality = ROOT }
		NEE_mark_clark = { set_nationality = ROOT }
	}
}

NEE_rebel_from_canada = {
	if = {
		limit = { is_subject = yes }
		overlord = {
			add_opinion_modifier = { target = PREV modifier = KR_outraged }
			set_autonomy = { target = PREV autonomy_state = autonomy_free }
			country_event = { id = newengland.15 hours = 8 }
		}
		leave_faction = yes
	}
	else_if = {
		limit = { is_in_faction = yes }
		faction_leader = {
			add_opinion_modifier = { target = PREV modifier = KR_outraged }
			country_event = { id = newengland.15 hours = 8 }
		}
		leave_faction = yes
	}
	if = {
		limit = { is_in_tech_sharing_group = entente_research }
		remove_from_tech_sharing_group = entente_research
	}
	if = {
		limit = { has_idea_with_trait = NEE_ambassador_to_canada }
		remove_ideas_with_trait = NEE_ambassador_to_canada
	}
	CAN_remove_from_iedc = yes
	peace_out_non_neighbours_after_leaving_faction = yes
	hidden_effect = {
		every_country = {
			limit = { is_american_tag = no }
			clear_embargo_PREV = yes
		}
	}
}

NEE_winner_logging = { # Excludes NEE as a winner. To be used with Quid Pro Quo
	hidden_effect = {
		if = {
			limit = { USA = { exists = yes } }
			log = "KR_Event_Logging;USA WINS ACW;[GetDateText]"
		}
		else_if = {
			limit = { PSA = { exists = yes } }
			log = "KR_Event_Logging;PSA WINS ACW;[GetDateText]"
		}
		else_if = {
			limit = { TEX = { exists = yes } }
			log = "KR_Event_Logging;TEX WINS ACW;[GetDateText]"
		}
		else = { #CSA exists
			log = "KR_Event_Logging;CSA WINS ACW;[GetDateText]"
		}
	}
}
