###########################
# Commune of France Decisions
###########################

FRA_internationale_category = {
	FRA_invite_serbia = {
		icon = generic_agreement

		available = {
			OR = {
				has_global_flag = AUS_treaty_of_budapest
				NOT = { country_exists = AUS }
				AUS = { is_subject = yes }
				FROM = {
					has_war = yes
					all_enemy_country = { has_war_with = ROOT }
				}
			}
		}

		visible = {
			is_faction_leader = yes
			FROM = {
				exists = yes
				has_socialist_government = yes
				is_valid_peace_target = yes
				NOT = { has_war_with = ROOT }
			}
		}

		targets = { SER }
		target_trigger = {
			FROM = {
				has_socialist_government = yes
				is_valid_peace_target = yes
				NOT = { has_war_with = ROOT }
			}
		}

		cost = 25
		days_remove = 7
		fire_only_once = yes
		cancel_if_not_visible = yes

		ai_will_do = { factor = 100 }

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove FRA_invite_serbia target: [From.GetName]"
			FROM = { country_event = comfrance.170 }
		}
	}
	FRA_Sabotage = {
		icon = generic_ignite_civil_war

		visible = {
			has_completed_focus = FRA_arab_committee
			can_declare_war_on = FROM
			FROM = {
				has_socialist_government = no
			}
		}

		cost = 80
		days_remove = FRA_Sabotage_days_remove?0
		days_re_enable = 240

		targets = { NFA }
		target_root_trigger = { has_completed_focus = FRA_arab_committee }
		target_trigger = {
			country_exists = FROM
			FROM = {
				has_socialist_government = no
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NFA = { is_in_faction = no }
			}
			modifier = {
				factor = 5
				has_war_with = FROM
			}
			modifier = {
				factor = 20
				any_owned_state = { is_controlled_by = FROM }
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete FRA_Sabotage target: [From.GetName]"
			set_variable = { FRA_Sabotage_days_remove = 120 }
			country_event = comfrance.65
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove FRA_Sabotage target: [From.GetName]"
			clear_variable = FRA_Sabotage_days_remove
			if = {
				limit = { has_country_flag = FRA_rebellion }
				FROM = { country_event = comfrance.67 }
			}
			if = {
				limit = { has_country_flag = FRA_unrest }
				FROM = { country_event = comfrance.68 }
			}
			else = {
				FROM = { country_event = comfrance.66 }
			}
			clr_country_flag = FRA_rebellion
			clr_country_flag = FRA_unrest
		}
	}

	FRA_end_the_algiers_regime = {
		icon = eng_puppet_usa

		available = {
			can_declare_war_on = FROM
			FROM = { is_in_faction = no }
		}

		cancel_trigger = {
			OR = {
				is_subject = yes
				NOT = { can_declare_war_on = FROM }
				FROM = { is_subject = yes }
				FROM = { is_in_faction = yes }
			}
		}

		targets = { NFA }
		target_trigger = {
			can_declare_war_on = FROM
			FROM = { is_subject = no }
		}

		cost = 20
		days_remove = 25
		fire_only_once = yes
		war_with_target_on_remove = yes

		ai_will_do = {
			base = 0
			modifier = {
				factor = 0
				ROOT_is_threatened = yes
			}
			modifier = {
				factor = 0
				FROM = { default_attack_AI_trigger_FROM = yes }
			}
			modifier = {
				factor = 0
				any_home_area_neighbor_country = { has_war_with = ROOT }
			}
		}

		cancel_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision cancel FRA_end_the_algiers_regime target: [From.GetName]"
			clear_decision_attack_AI = yes
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete FRA_end_the_algiers_regime target: [From.GetName]"
			setup_decision_attack_AI = yes
			hidden_effect = {
				FROM = { incoming_war_notification_effect = yes }
				every_other_country = {
					limit = { is_ally_with = ROOT }
					country_event = generic_events.32
				}
			}
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove FRA_end_the_algiers_regime target: [From.GetName]"
			clear_decision_attack_AI = yes
			declare_war_on = {
				target = FROM
				type = annex_everything
			}
		}
	}

	FRA_help_SWF = {
		icon = generic_industry

		visible = {
			FROM = { has_civil_war = yes }
		}

		custom_cost_text = 2000_infantry_equipment_1
		custom_cost_trigger = {
			has_equipment = { infantry_equipment > 1999 }
		}
		fire_only_once = yes

		targets = { SWF }
		target_root_trigger = {
			has_country_flag = FRA_support_SWF
		}
		target_trigger = {
			FROM = { has_civil_war = yes }
		}

		ai_will_do = {
			factor = 3
			modifier = {
				factor = 0
				has_equipment = { infantry_equipment < 5000 }
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete FRA_help_SWF target: [From.GetName]"
			clr_country_flag = FRA_support_SWF
			FROM = {
				country_event = comfrance.124
			}
			add_manpower = -2000
			send_equipment = {
				target = FROM
				type = infantry_equipment
				amount = 2000
			}
		}
	}

	FRA_help_SOV = {
		icon = generic_industry

		available = {
			has_equipment = { infantry_equipment > 599 }
			has_equipment = { support_equipment > 99 }
			has_equipment = { artillery_equipment > 49 }
		}

		visible = {
			FROM = {
				has_war_with = RUS
				has_socialist_government = yes
			}
		}

		cost = 0
		fire_only_once = yes

		targets = { SOV }
		target_trigger = {
			FROM = {
				has_war_with = RUS
				has_socialist_government = yes
			}
		}

		ai_will_do = {
			factor = 3
			modifier = {
				factor = 0
				has_equipment = { infantry_equipment < 5000 }
			}
			modifier = {
				factor = 0
				has_equipment = { support_equipment < 250 }
			}
			modifier = {
				factor = 0
				has_equipment = { artillery_equipment < 125 }
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete FRA_help_SOV target: [From.GetName]"
			FROM = {
				add_one_random_civilian_factory = yes
			}
			send_equipment = {
				target = FROM
				type = infantry_equipment
				amount = 600
			}
			send_equipment = {
				target = FROM
				type = support_equipment
				amount = 100
			}
			send_equipment = {
				target = FROM
				type = artillery_equipment
				amount = 50
			}
		}
	}

	FRA_help_CHL = {
		icon = generic_industry

		visible = {
			has_country_flag = FRA_help_chile
			FROM = {
				has_socialist_government = yes
			}
		}

		cost = 40
		fire_only_once = yes

		targets = { CHL }
		target_root_trigger = {
			has_country_flag = FRA_help_chile
		}
		target_trigger = {
			FROM = {
				has_socialist_government = yes
			}
		}

		ai_will_do = { factor = 5 }

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete FRA_help_CHL target: [From.GetName]"
			clr_country_flag = FRA_help_chile
			FROM = {
				country_event = comfrance.125
			}
		}
	}

	FRA_mobilise_the_reserves = {
		icon = generic_prepare_civil_war

		available = {
			OR = {
				surrender_progress > 0.25
				NOT = { has_full_control_of_state = 16 }
				AND = {
					NOT = { 18 = { is_controlled_by = ROOT } }
					NOT = { 24 = { is_controlled_by = ROOT } }
				}
			}
		}

		visible = {
			has_war = yes
			has_capitulated = no
			any_enemy_country = { is_actual_major = yes }
		}

		cost = 100
		fire_only_once = yes

		ai_will_do = { base = 1000 }

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete FRA_mobilise_the_reserves"
			add_manpower = 100000
			add_equipment_to_stockpile = {
				type = infantry_equipment
				amount = 3000
			}
			if = {
				limit = { controls_province = 11506 } #Paris
				16 = {
					add_building_construction = {
						type = bunker
						level = 4
						instant_build = yes
						province = {
							all_provinces = yes
							limit_to_border = yes
						}
					}
				}
			}
			division_template = {
				name = "Milice Communale"
				division_names_group = FRA_MIL_01
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 0 y = 2 }
					infantry = { x = 1 y = 0 }
					infantry = { x = 1 y = 1 }
					infantry = { x = 1 y = 2 }
					infantry = { x = 2 y = 0 }
					infantry = { x = 2 y = 1 }
					infantry = { x = 2 y = 2 }
				}
				template_counter = 73
			}
			random_owned_controlled_state = {
				prioritize = { 16 }
				limit = {
					is_core_of = ROOT
					is_in_home_area = yes
				}
				create_unit = {
					division = "division_template = \"Milice Communale\" start_experience_factor = 0.3"
					owner = ROOT
					count = 4
				}
			}
			random_owned_controlled_state = {
				prioritize = { 15 }
				limit = {
					is_core_of = ROOT
					is_in_home_area = yes
				}
				create_unit = {
					division = "division_template = \"Milice Communale\" start_experience_factor = 0.3"
					owner = ROOT
					count = 4
				}
			}
			random_owned_controlled_state = {
				prioritize = { 33 }
				limit = {
					is_core_of = ROOT
					is_in_home_area = yes
				}
				create_unit = {
					division = "division_template = \"Milice Communale\" start_experience_factor = 0.3"
					owner = ROOT
					count = 4
				}
			}
			random_owned_controlled_state = {
				prioritize = { 27 }
				limit = {
					is_core_of = ROOT
					is_in_home_area = yes
				}
				create_unit = {
					division = "division_template = \"Milice Communale\" start_experience_factor = 0.3"
					owner = ROOT
					count = 4
				}
			}
		}
	}
}

@FRA_phalanstere_decision_cost = 50
@FRA_phalanstere_decision_time = 50

FRA_phalanstere_category = {
	FRA_join_phalanstere = {
		icon = generic_research

		allowed = {
			has_tech_sharing_feature = yes
			NOT = {
				tag = FRA #added by event
				tag = ENG
				tag = GER #always hostile
				tag = GEA
				tag = MAF
				tag = RUS
				tag = NFA
				tag = SRD
				tag = SIC
				tag = ITA
				tag = PAP
				tag = ARG
				tag = USA
				tag = TEX
				tag = PSA
				tag = NEE
				tag = RAJ
				tag = PRF
				tag = DEI
			}
		}

		cost = 0
		fire_only_once = yes

		targets = { INT }
		target_root_trigger = { is_in_faction_with = INT }
		target_trigger = {
			is_in_faction_with = FROM
			NOT = { has_country_flag = FRA_phanlanstere_member }
			FROM = {
				has_country_flag = FRA_phanlanstere_member
				is_faction_leader = yes
			}
		}

		ai_will_do = { factor = 100 }

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete FRA_join_phalanstere target: [From.GetName]"
			FRA_add_to_phalanstere = yes
		}
	}

	FRA_Develop_Country = {
		icon = generic_construction

		allowed = { tag = FRA }

		available = {
			NOT = { has_global_flag = FRA_ongoing_phalanstere_development }
			FROM = { has_civil_war = no }
		}

		cancel_trigger = {
			OR = {
				NOT = { country_exists = FROM }
				has_war_with = FROM
				FROM = { has_socialist_government = no }
				is_faction_leader = no
			}
		}

		targets = { ENG SRI SWF NOR HND MEX GUA ELS HON NIC COS PAN CEN CUB HAI DOM WIF BRA FOP CHL URG PAR BOL PRU ECU COL VEN }
		target_root_trigger = { has_global_flag = FRA_created_phalanstere }
		target_trigger = {
			FROM = {
				has_socialist_government = yes
				NOT = { has_war_with = ROOT }
			}
			is_faction_leader = yes
		}

		fire_only_once = yes
		cost = @FRA_phalanstere_decision_cost
		days_remove = @FRA_phalanstere_decision_time

		ai_will_do = { factor = 4 }

		cancel_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision cancel FRA_Develop_Country target: [From.GetName]"
			hidden_effect = { add_political_power = @FRA_phalanstere_decision_cost }
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete FRA_Develop_Country target: [From.GetName]"
			set_global_flag = { flag = FRA_ongoing_phalanstere_development days = @FRA_phalanstere_decision_time value = 1 }
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove FRA_Develop_Country target: [From.GetName]"
			set_temp_variable = { FRA_num_target_states = FROM.num_of_factories }
			divide_temp_variable = { FRA_num_target_states = FRA.num_of_factories }
			multiply_temp_variable = { FRA_num_target_states = 10 }
			round_temp_variable = FRA_num_target_states
			if = {
				limit = { ENG = { FRA_is_phalanstere_member = no } }
				divide_temp_variable = { FRA_num_target_states = 2 }
				clamp_temp_variable = { var = FRA_num_target_states min = 1 max = 4 }
			}
			FROM = {
				country_event = comfrance.129
				effect_tooltip = { FRA_phalanstere_effect = yes }
			}
		}
	}
}

FRA_liberate_europe_category = {
	FRA_invade_liberation_target = {
		icon = generic_nationalism

		visible = {
			can_declare_war_on = FROM
			FROM = {
				has_socialist_government = no
			}
		}

		target_array = global.european_tags_array
		target_root_trigger = {
			has_completed_focus = FRA_european_revolution
		}
		target_trigger = {
			can_declare_war_on = FROM
			FROM = {
				has_socialist_government = no
			}
		}

		cost = 20
		days_remove = 25
		fire_only_once = yes
		war_with_target_on_remove = yes
		cancel_if_not_visible = yes
		ai_will_do = {
			base = 0
			modifier = {
				factor = 0
				OR = {
					has_war = yes
					has_country_flag = imminent_war
				}
			}
			modifier = {
				add = 50
				is_neighbor_of = FROM
			}
			modifier = {
				add = 10
				FROM = {
					NOT = { is_neighbor_of = FROM }
					any_neighbor_country = {
						is_in_faction_with = ROOT
					}
				}
			}
			modifier = {
				add = 5
				FROM = {
					NOT = {
						is_neighbor_of = FROM
						any_neighbor_country = {
							is_in_faction_with = ROOT
						}
					}
					any_owned_state = {
						is_coastal = yes
					}
				}
			}
		}

		cancel_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision cancel FRA_invade_liberation_target target: [From.GetName]"
			clear_decision_attack_AI = yes
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision complete FRA_invade_liberation_target target: [From.GetName]"
			setup_decision_attack_AI = yes
			FROM = { incoming_war_notification_effect = yes }
			every_other_country = {
				limit = { is_ally_with = ROOT }
				country_event = generic_events.32
			}
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove FRA_invade_liberation_target target: [From.GetName]"
			clear_decision_attack_AI = yes
			declare_war_on = {
				target = FROM
				type = annex_everything
			}
		}
	}
}

